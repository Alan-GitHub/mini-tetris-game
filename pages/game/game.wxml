<view class="game-container retro">
  <!-- Title -->
  <view class="game-title">俄罗斯方块</view>

  <!-- Main Screen Area -->
  <view class="screen-frame">
    <view class="screen-inner">
      <!-- Game Board -->
      <view class="game-board">
        <canvas 
          type="2d" 
          id="gameCanvas" 
          class="game-canvas"
          bindtouchstart="onTouchStart"
          bindtouchend="onTouchEnd"
        ></canvas>
      </view>
      
      <!-- Info Panel -->
      <view class="info-panel">
        <view class="info-section">
          <view class="info-label">得分</view>
          <view class="info-value">{{score}}</view>
        </view>
        <view class="info-section">
          <view class="info-label">消除行</view>
          <view class="info-value">{{lines}}</view>
        </view>
        <view class="info-section">
          <view class="info-label">级别</view>
          <view class="info-value">{{level}}</view>
        </view>
        <view class="info-section next-section">
          <view class="info-label">下一个</view>
          <view class="next-preview" wx:if="{{nextPiece}}">
            <view 
              class="preview-row" 
              wx:for="{{nextPiece.shape}}" 
              wx:for-item="row" 
              wx:key="index"
            >
              <view 
                class="preview-cell {{cell ? 'active' : ''}}" 
                wx:for="{{row}}" 
                wx:for-item="cell" 
                wx:key="index"
                style="background-color: {{cell ? nextPiece.color : 'transparent'}}"
              ></view>
            </view>
          </view>
        </view>
        <!-- Sound Toggle -->
        <view class="sound-toggle" bindtap="toggleSound">
          <text class="sound-icon">{{soundEnabled ? '🔊' : '🔇'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Controls Area -->
  <view class="controls-area">
    <!-- Top Row: Function Buttons -->
    <view class="function-buttons">
      <view class="func-btn-wrapper">
        <button class="func-btn pause" bindtap="onPause"></button>
        <text class="func-label">暂停(P)</text>
      </view>
      <view class="func-btn-wrapper">
        <button class="func-btn sound" bindtap="toggleSound"></button>
        <text class="func-label">音效(S)</text>
      </view>
      <view class="func-btn-wrapper">
        <button class="func-btn restart" bindtap="onRestart"></button>
        <text class="func-label">重玩(R)</text>
      </view>
    </view>

    <!-- Main Controls -->
    <view class="main-controls">
      <!-- Drop Button (Left) -->
      <view class="drop-area">
        <text class="btn-label-top">掉落\n(SPACE)</text>
        <button class="big-btn drop" bindtap="onDrop"></button>
      </view>

      <!-- Direction Buttons (Right) -->
      <view class="direction-area">
        <view class="dir-row top">
          <text class="dir-label-top">旋转</text>
          <button class="dir-btn rotate" bindtap="onRotate"></button>
        </view>
        <view class="dir-row middle">
          <view class="dir-btn-wrapper">
            <text class="dir-label-top">左移</text>
            <button class="dir-btn left" bindtap="onLeft"></button>
          </view>
          <view class="dir-center">
            <view class="arrow-cross">
              <view class="arrow up"></view>
              <view class="arrow right"></view>
              <view class="arrow down"></view>
              <view class="arrow left"></view>
            </view>
          </view>
          <view class="dir-btn-wrapper">
            <text class="dir-label-top">右移</text>
            <button class="dir-btn right" bindtap="onRight"></button>
          </view>
        </view>
        <view class="dir-row bottom">
          <text class="dir-label-top">下移</text>
          <button 
            class="dir-btn down" 
            bindtap="onDown"
            bindlongpress="onDownLongPress"
            bindtouchend="onDownTouchEnd"
            bindtouchcancel="onDownTouchEnd"
          ></button>
        </view>
      </view>
    </view>
  </view>

  <!-- Game Over Modal -->
  <view class="modal" wx:if="{{gameOver}}">
    <view class="modal-content">
      <view class="modal-title">游戏结束</view>
      <view class="modal-score">最终得分: {{score}}</view>
      <view class="modal-buttons">
        <button class="modal-btn restart-btn" bindtap="onRestart">重新开始</button>
        <button class="modal-btn back-btn" bindtap="onBack">返回首页</button>
      </view>
    </view>
  </view>

  <!-- Pause Modal -->
  <view class="modal pause-modal" wx:if="{{paused && !gameOver}}">
    <view class="modal-content">
      <view class="modal-title">游戏暂停</view>
      <view class="modal-buttons">
        <button class="modal-btn restart-btn" bindtap="onPause">继续游戏</button>
        <button class="modal-btn back-btn" bindtap="onBack">返回首页</button>
      </view>
    </view>
  </view>
</view>
